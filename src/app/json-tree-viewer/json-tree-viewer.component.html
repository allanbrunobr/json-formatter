<!-- json-tree-viewer.component.html -->
<div class="json-viewer-container">
  <div class="toolbar">
    <div class="status-bar" [class.valid]="isValid">
      {{ isValid ? 'VALID (RFC 8259)' : 'INVALID JSON' }}
    </div>

    <div class="tools">
      <div class="search-box">
        <input
          [(ngModel)]="searchQuery"
          (ngModelChange)="onSearch()"
          placeholder="Buscar no JSON..."
          class="search-input"
        >
        <div class="search-results" *ngIf="searchResults.length > 0">
          {{ searchResults.length }} resultados
          <button
            (click)="navigateSearch(-1)"
            [disabled]="currentSearchIndex <= 0"
          >â†‘</button>
          <button
            (click)="navigateSearch(1)"
            [disabled]="currentSearchIndex >= searchResults.length - 1"
          >â†“</button>
        </div>
      </div>

      <button class="tool-button" (click)="expandAll()">
        Expandir Tudo
      </button>
      <button class="tool-button" (click)="collapseAll()">
        Colapsar Tudo
      </button>
      <button class="tool-button" (click)="copyAll()">
        Copiar JSON
      </button>
    </div>
  </div>

  <div class="main-content">
    <div class="editor-section">
      <div class="json-content">
        <ng-container *ngFor="let node of renderNodes">
          <div
            class="tree-node"
            [attr.data-level]="node.level"
            [style.marginLeft.px]="node.level * 20"
            [class.highlighted]="isNodeHighlighted(node)"
            [attr.data-path]="getNodePath(node)"
          >
            <div class="node-content">
              <span
                *ngIf="isExpandable(node.value)"
                class="expand-button"
                (click)="toggleNode(getNodePath(node))"
                [attr.title]="isExpanded(getNodePath(node)) ? 'Colapsar' : 'Expandir'"
              >
                {{ isExpanded(getNodePath(node)) ? 'â–¼' : 'â–¶' }}
              </span>

              <span class="colon" *ngIf="node.key !== undefined">: </span>

              <span *ngIf="!node.isLast" class="comma">,</span>

              <div class="node-actions">
                <button
                  class="action-button small"
                  [matMenuTriggerFor]="addMenu"
                  title="Adicionar"
                >
                  +
                </button>
                <mat-menu #addMenu="matMenu">
                  <ng-container *ngIf="Array.isArray(node.value)">
                    <button mat-menu-item (click)="addArrayItem(node, 'primitive')">
                      <mat-icon>add_circle_outline</mat-icon>
                      <span>Adicionar valor primitivo</span>
                    </button>
                    <button mat-menu-item (click)="addArrayItem(node, 'object')">
                      <mat-icon>add_box</mat-icon>
                      <span>Adicionar objeto</span>
                    </button>
                    <button mat-menu-item (click)="addArrayItem(node, 'array')">
                      <mat-icon>list</mat-icon>
                      <span>Adicionar array</span>
                    </button>
                    <button mat-menu-item (click)="addCopySimilarItem(node)">
                      <mat-icon>content_copy</mat-icon>
                      <span>Duplicar elemento</span>
                    </button>
                  </ng-container>

                  <ng-container *ngIf="isObject(node.value)">
                    <button mat-menu-item (click)="addKeyValuePair(node)">
                      <mat-icon>add_box</mat-icon>
                      <span>Adicionar par chave:valor</span>
                    </button>
                    <button mat-menu-item (click)="addCopySimilarItem(node)">
                      <mat-icon>content_copy</mat-icon>
                      <span>Duplicar objeto</span>
                    </button>
                  </ng-container>
                </mat-menu>

                <button
                  class="action-button small"
                  (click)="editNode(node)"
                  [disabled]="!canEditNode(node)"
                  title="Editar"
                >
                  âœŽ
                </button>
                <button
                  class="action-button small"
                  (click)="deleteNode(node)"
                  [disabled]="!canDeleteNode(node)"
                  title="Deletar"
                >
                  ðŸ—‘
                </button>
              </div>
            </div>

            <!-- Indicador de tipo e tamanho (opcional) -->
<!--            <div class="type-indicator" *ngIf="isExpandable(node.value)">-->
<!--              <span class="type-badge">-->
<!--                {{ Array.isArray(node.value) ?-->
<!--                'Array[' + node.value.length + ']' :-->
<!--                'Object{' + Object.keys(node.value).length + '}'-->
<!--                }}-->
<!--              </span>-->
<!--            </div>-->
          </div>
        </ng-container>
      </div>
    </div>

    <!-- Preview do JSON -->
    <div class="preview-section">
      <h3>Preview do JSON</h3>
      <pre>{{ jsonData | json }}</pre>
    </div>
  </div>
</div>
