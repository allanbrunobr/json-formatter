<!-- json-tree-viewer.component.html -->
<div class="json-viewer-container">
  <!-- Barra de status e ferramentas -->
  <div class="toolbar">
    <div class="status-bar" [class.valid]="isValid">
      {{ isValid ? 'VALID (RFC 8259)' : 'INVALID JSON' }}
    </div>

    <div class="tools">
      <div class="search-box">
        <input
          [(ngModel)]="searchQuery"
          (ngModelChange)="onSearch()"
          placeholder="Buscar no JSON..."
          class="search-input"
        >
        <div class="search-results" *ngIf="searchResults.length > 0">
          {{ searchResults.length }} resultados
          <button
            (click)="navigateSearch(-1)"
            [disabled]="currentSearchIndex <= 0"
          >â†‘</button>
          <button
            (click)="navigateSearch(1)"
            [disabled]="currentSearchIndex >= searchResults.length - 1"
          >â†“</button>
        </div>
      </div>

      <button class="tool-button" (click)="expandAll()">
        Expandir Tudo
      </button>
      <button class="tool-button" (click)="collapseAll()">
        Colapsar Tudo
      </button>
      <button class="tool-button" (click)="copyAll()">
        Copiar JSON
      </button>
    </div>
  </div>


  <div class="main-content">
    <!-- Visualizador do JSON (lado esquerdo) -->
    <div class="editor-section">
  <!-- Visualizador do JSON -->
  <div class="json-content">
    <ng-container *ngFor="let node of renderNodes">
      <div
        class="tree-node"
        [style.marginLeft.px]="node.level * 20"
        [class.highlighted]="isNodeHighlighted(node)"
        [attr.data-path]="getNodePath(node)"
      >
        <div class="node-content">
          <!-- BotÃ£o de expandir/colapsar -->
          <span
            *ngIf="isExpandable(node.value)"
            class="expand-button"
            (click)="toggleNode(getNodePath(node))"
            [attr.title]="isExpanded(getNodePath(node)) ? 'Colapsar' : 'Expandir'"
          >
            {{ isExpanded(getNodePath(node)) ? 'â–¼' : 'â–¶' }}
          </span>

          <!-- Chave -->
          <span
            class="key"
            *ngIf="node.key !== undefined"
            [class.matched]="isKeyMatched(node)"
            (click)="copyToClipboard(node.key.toString())"
            [attr.title]="'Clique para copiar: ' + node.key"
          >
            "{{ node.key }}"
          </span>

          <span class="colon" *ngIf="node.key !== undefined">: </span>

          <!-- Valor -->
          <span
            [class]="'value ' + getValueType(node.value)"
            [class.matched]="isValueMatched(node)"
            (click)="copyToClipboard(formatValue(node.value))"
            [attr.title]="'Clique para copiar: ' + formatValue(node.value)"
          >
            {{ formatValue(node.value) }}
          </span>

          <span *ngIf="!node.isLast" class="comma">,</span>

          <!-- BotÃµes de aÃ§Ã£o -->
          <div class="node-actions">
            <button
              *ngIf="isExpandable(node.value)"
              class="action-button small"
              (click)="addSimilarItem(node)"
              title="Adicionar item similar"
            >
              +
            </button>
            <button
              class="action-button small"
              (click)="editNode(node)"
              title="Editar"
            >
              âœŽ
            </button>
            <button
              class="action-button small"
              (click)="deleteNode(node)"
              title="Deletar"
            >
              ðŸ—‘
            </button>
          </div>
        </div>

        <!-- Indicador de tipo e tamanho (opcional) -->
        <div class="type-indicator" *ngIf="isExpandable(node.value)">
          <span class="type-badge">
            {{ Array.isArray(node.value) ?
            'Array[' + node.value.length + ']' :
            'Object{' + Object.keys(node.value).length + '}'
            }}
          </span>
        </div>
      </div>
    </ng-container>
  </div>
    </div>

  <!-- Preview do JSON -->
  <div class="preview-section">
    <h3>Preview do JSON</h3>
    <pre>{{ jsonData | json }}</pre>
  </div>
</div>
</div>
